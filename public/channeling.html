<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Doctor Channeling</title>
  <link rel="stylesheet" href="navbar.css" />
  <link rel="stylesheet" href="styles_channeling.css" />
</head>
<body>
  <nav class="navbar">
    <a href="index.html">Home</a>
    <a href="channeling.html">Channeling</a>
  </nav>

  <div class="container">
    <h1>Book Your Appointment</h1>
    <form id="channelingForm" action="/channeling" method="POST" class="form-card">
      <label for="doctor">Select Doctor:</label>
      <select id="doctor" name="doctorId" required>
        <option value="">Loading doctors...</option>
      </select>

      <label for="channel_date">Select Date:</label>
      <input type="date" id="channel_date" name="channel_date" required />

      <label for="channel_time">Select Time Slot:</label>
      <select id="channel_time" name="slot_id" required>
        <option value="">Select a time slot</option>
      </select>

      <button type="submit">Book Appointment</button>
    </form>
  </div>

  <script>
    // Load doctors on page load
    const doctorSelect = document.getElementById('doctor');
    const dateInput = document.getElementById('channel_date');
    const timeSelect = document.getElementById('channel_time');

    fetch('/doctors')
      .then(res => res.json())
      .then(data => {
        doctorSelect.innerHTML = '<option value="">-- Select Doctor --</option>';
        data.forEach(doc => {
          const opt = document.createElement('option');
          opt.value = doc.id; // assuming doctor object has id and name
          opt.textContent = doc.name;
          doctorSelect.appendChild(opt);
        });
      })
      .catch(() => {
        doctorSelect.innerHTML = '<option value="">Failed to load doctors</option>';
      });

    function fetchSlots() {
      const doctorId = doctorSelect.value;
      const date = dateInput.value;
      timeSelect.innerHTML = '<option value="">Select a time slot</option>';
      if (!doctorId || !date) return;

      fetch(`/available-slots?doctorId=${doctorId}&date=${date}`)
        .then(res => res.json())
        .then(slots => {
          if (slots.length === 0) {
            timeSelect.innerHTML += '<option value="">No available slots</option>';
          } else {
            slots.forEach(slot => {
              const opt = document.createElement('option');
              opt.value = slot.id;
              opt.textContent = slot.slot_time.slice(0, 5);
              timeSelect.appendChild(opt);
            });
          }
        })
        .catch(() => {
          timeSelect.innerHTML += '<option value="">Error loading slots</option>';
        });
    }

    doctorSelect.addEventListener('change', fetchSlots);
    dateInput.addEventListener('change', fetchSlots);
  </script>
</body>
</html>
